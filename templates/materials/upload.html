{% extends "base.html" %}

{% block title %}Upload PDF - ProbeTect{% endblock %}

{% block content %}
<section class="bg-white py-12">
  <div class="mx-auto max-w-5xl px-6">
    <div class="flex flex-col gap-6 md:flex-row md:items-start md:justify-between">
      <div>
        <p class="text-sm uppercase tracking-[0.2em] text-indigo-500">Upload</p>
        <h1 class="mt-2 text-3xl font-semibold text-slate-900">Add new study material</h1>
        <p class="mt-2 text-sm text-slate-600">Drop a PDF and ProbeTect will prepare it for quiz generation and lesson planning.</p>
      </div>
      <a href="#queue" class="text-sm font-medium text-indigo-600">View processing queue</a>
    </div>

    {% if messages %}
      <div class="mt-6 space-y-3">
        {% for message in messages %}
          <div class="rounded-2xl border border-slate-200 bg-slate-50 p-3 text-sm text-slate-700">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="mt-8 grid gap-8 lg:grid-cols-3">
      <form method="post" enctype="multipart/form-data" class="lg:col-span-2 space-y-6 rounded-3xl border border-slate-200 bg-white p-8 shadow-sm">
        {% csrf_token %}
        <div class="rounded-2xl border border-dashed border-indigo-300 bg-indigo-50 p-6 text-center">
          <p class="text-sm font-medium text-slate-600">Drag and drop your PDF here or click to browse.</p>
          <div class="mt-4 inline-flex items-center justify-center">
            {{ form.pdf }}
          </div>
          <p class="mt-2 text-xs text-slate-500">{{ form.pdf.help_text }}</p>
          {% if form.pdf.errors %}
            <p class="mt-2 text-xs text-rose-600">{{ form.pdf.errors|join:", " }}</p>
          {% endif %}
        </div>

        <div class="grid gap-4 md:grid-cols-2">
          <div>
            <label class="text-sm font-medium text-slate-700" for="{{ form.title.id_for_label }}">Title</label>
            {{ form.title }}
            {% if form.title.errors %}
              <p class="mt-1 text-xs text-rose-600">{{ form.title.errors|join:", " }}</p>
            {% endif %}
          </div>
          <div>
            <label class="text-sm font-medium text-slate-700" for="{{ form.subject.id_for_label }}">Subject</label>
            {{ form.subject }}
            {% if form.subject.errors %}
              <p class="mt-1 text-xs text-rose-600">{{ form.subject.errors|join:", " }}</p>
            {% endif %}
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-slate-700" for="{{ form.description.id_for_label }}">Notes</label>
          {{ form.description }}
          {% if form.description.errors %}
            <p class="mt-1 text-xs text-rose-600">{{ form.description.errors|join:", " }}</p>
          {% endif %}
        </div>

        <div>
          <label class="text-sm font-medium text-slate-700" for="{{ form.visibility.id_for_label }}">Visibility</label>
          {{ form.visibility }}
          {% if form.visibility.errors %}
            <p class="mt-1 text-xs text-rose-600">{{ form.visibility.errors|join:", " }}</p>
          {% endif %}
        </div>

        <button type="submit" class="w-full rounded-lg bg-indigo-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-indigo-500">Upload PDF</button>
      </form>

      <aside class="space-y-4 rounded-3xl border border-slate-200 bg-slate-50 p-6">
        <h2 class="text-lg font-semibold text-slate-900">Tips</h2>
        <ul class="space-y-3 text-sm text-slate-600">
          <li>- Keep files under 25 MB and ensure they contain searchable text for the best quiz results.</li>
          <li>- Describe subjects clearly so ProbeTect can group recommendations.</li>
          <li>- Visibility controls who can access the material when sharing in future sprints.</li>
        </ul>
      </aside>
    </div>

    <div id="queue" class="mt-12">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold text-slate-900">Recent uploads</h2>
        <a href="#" class="text-sm text-indigo-600">Manage library</a>
      </div>
      <div class="mt-4 grid gap-4">
        {% if materials %}
          {% for material in materials %}
            <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
              <div class="flex flex-wrap items-center justify-between gap-3">
                <div>
                  <p class="text-sm font-semibold text-slate-900">{{ material.title }}</p>
                  <p class="text-xs text-slate-500">Uploaded {{ material.created_at|date:"M j, Y" }} - {{ material.get_status_display }}</p>
                  <form method="post" action="{% url 'quizzes:generate' material.id %}" class="mt-3 flex items-center gap-3">
                    {% csrf_token %}
                    <select name="question_count" class="block w-24 rounded-lg border border-slate-200 bg-white px-3 py-1 text-sm shadow-sm focus:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-200">
                    <option value="5" selected>5 questions</option>
                    <option value="10">10 questions</option>
                  </select>
                    <button type="submit" class="inline-flex items-center rounded-lg bg-indigo-600 px-3 py-1.5 text-xs font-semibold text-white transition hover:bg-indigo-500">Generate quiz</button>
                  </form>
                  {% with quiz_total=material.quizzes.count %}
                    {% if quiz_total %}
                      <a href="{% url 'quizzes:list_by_material' material.id %}" class="mt-2 inline-flex items-center text-xs font-semibold text-indigo-600 transition hover:text-indigo-500">View {{ quiz_total }} quiz{{ quiz_total|pluralize }}</a>
                    {% endif %}
                  {% endwith %}
                </div>
                <div class="flex items-center gap-3 text-xs text-slate-500">
                  <span>{{ material.subject|default:"No subject" }}</span>
                  <span class="rounded-full bg-slate-100 px-3 py-1 text-slate-600">{{ material.get_visibility_display }}</span>
                </div>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="rounded-2xl border border-dashed border-slate-300 bg-white p-6 text-center text-sm text-slate-500">
            You have not uploaded any PDFs yet. Your recent uploads will appear here with processing updates.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
